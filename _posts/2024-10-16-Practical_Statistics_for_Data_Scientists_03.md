---
layout : markdown
title : 데이터 과학을 위한 통계 - 통계적 실험과 유의성검정
tags : [Practical_Statistics_for_Data_Scientists, Python, Book]
toc : true
---
{% include markdown.html %}

> 전형적인 통계 추론 과정

1. 가설을 세운다.
2. 실험을 설계한다.
3. 데이터를 수집한다.
4. 추론 및 결론을 도출한다.

# A/B 검정

> A/B 검정 : 두 가지 처리 방법, 제품, 절차 중 어느 쪽이 다른 쪽보다 더 우월하다는 것을 입증하기 위해 실험군을 두 그룹으로 나누어 진행하는 실험

- 처리(treatment) : 어떤 대상에 주어지는 특별한 환경이나 조건
- 처리군(처리 그룹, treatment group) : 특정 처리에 노출된 대상들의 집단
- 대조군(대조 그룹, control group) : 어떤 처리도 하지 않은 대상들의 집단
- 임의화(랜덤화, randomization) : 처리를 적용할 대상을 임의로 결정하는 과정
- 대상(subject) : 처리를 적용할 개체 대상(유의어 : 피실험자)
- 검정통계량(test statistic) : 처리 효과를 측정하기 위한 지표

```python
# A/B 테스트 데이터
# A 그룹의 데이터 (예: A 버전의 전환율)
A_conversions = 45  # 전환한 사람 수
A_total = 500       # A 그룹의 총 사용자 수

# B 그룹의 데이터 (예: B 버전의 전환율)
B_conversions = 60  # 전환한 사람 수
B_total = 520       # B 그룹의 총 사용자 수

# 비율 계산 (전환율)
A_rate = A_conversions / A_total # 0.0900
B_rate = B_conversions / B_total # 0.1154

# 각 그룹의 표준 오차 계산
A_std_error = np.sqrt(A_rate * (1 - A_rate) / A_total)
B_std_error = np.sqrt(B_rate * (1 - B_rate) / B_total)

# Z-통계량 계산 (Z-score)
z_score = (B_rate - A_rate) / np.sqrt(A_std_error**2 + B_std_error**2) # 1.3377

# p-value 계산
p_value = stats.norm.sf(abs(z_score)) * 2  # 양측 테스트이므로 * 2 , p-value : # 0.1810
```

> p_value > 유의수준(0.05) 이므로 통계적으로 유의한 차이가 없다.


# 가설검정

- 귀무가설 : 우연 때문이라는 가설(=영가설)
- 대립가설 : 귀무가설과의 대조(증명하고자 하는 가설)
- 일원검정 : 한 방향으로만 우연히 일어날 확률을 계산하는 가설검정
- 이원검정 : 양방향으로 우연히 일어날 확률을 계산하는 가설검정

> 위 A/B test 에서 p-value 값이 0.1810 이므로 귀무가설을 기각할 수 없다.

# 재표본추출

> 재표본추출 : 랜덤한 변동성을 알아보자는 일반적인 목표를 가지고, 관찰된 데이터의 값에서 표본을 반복적으로 추출하는 것을 의미

- 순열검정 : 두 개 이상의 표본을 함께 결합하여 관측값들을 무작위로 재표본으로 추출하는 과정
- 복원/비복원 : 표본을 추출할 때, 이미 한 번 뽑은 데이터를 다음번 추출을 위해 다시 제자리에 돌려 놓거나/다음 추출에서 제외하는 표본추출 방법

# 통계적 유의성과 P 값

- p-value : 귀무가설을 구체화한 기회 모델이 주어졌을 때 관측된 결과와 같이 특이하거나 극단적인 결과를 얻을 확률
- alpha : 실제 결과가 통계적으로 의미 있는 것으로 간주되기 위해, 우연에 의한 결과가 능가해야 하는 '비정상적인' 기능성의 임계 확률
- 제 1종 오류 : 우연에 의한 효과를 실제 효과라고 잘못 결론 내리는 것
- 제 2종 오류 : 실제 효과를 우연에 의한 효과라고 잘못 결론 내리는 것

# t 검정

- 검정통계량 : 관심의 차이 또는 효과에 대한 측정 지표
- t 통계량 : 평균과 같이 표준화된 형태의 일반적인 검정통계량
- t 분포 : 관측된 t 통계량을 비교할 수 있는 (귀무가설에서 파생된)기준분포

```python
# 두 집단의 데이터 예시
group_A = np.array([23, 25, 27, 22, 20, 30, 28, 26, 24, 29])
group_B = np.array([31, 33, 35, 29, 27, 40, 36, 34, 32, 38])

# 두 집단에 대한 독립 표본 t-검정 수행
t_stat, p_value = stats.ttest_ind(group_A, group_B) # t : -5.0138, p : 0.0001

# 자유도 계산
df = len(group_A) + len(group_B) - 2
```

{% include plotly/t-distribution.html %}

# 다중검정

- FDR(거짓 발견 비율, false discovery rate) : 다중검정에서 1종 오류가 발생하는 비율
- 알파 인플레이션 : 1종 오류를 만들 확률인 알파가 더 많은 테스트를 수행할수록 증가하는 다중검정 현상
- p값 조정(adjustment of p-value) : 동일한 데이터에 대해 다중검정을 수행하는 경우에 필요하다

# 자유도

> n-1 을 자유도라 한다.  
> 그 이유는 표본을 통해 모집단의 분석을 추정하고자 할 때 분모의 n을 사용하면 추정치가 살짝 아래쪽으로 편향이 발생하기 때문

- d.f.(degrees of freedom) : 자유도

# 분산분석

> 분산분석(analysis of variance, ANOVA) : 여러 그룹 간의 통계적으로 유의미한 차이를 검정하는 통계적 절차

- pairwise comparison : 여러 그룹 중 두 그룹 간의 가설검정
- omnibus test : 여러 그룹 평균들의 전체 분산에 관한 단일 가설검정
- 분산분해(decomposition of variance) : 구성 요소 분리 | Ex. 전체 평균, 처리 평균, 잔차 오차로부터 개별 값들에 대한 기여를 뜻함
- F-statistic : 그룹 평균 간의 차이가 랜덤 모델에서 예상되는 것에서 벗어나는 정도를 측정하는 표준화된 통계량
- SS(sum of squares) : 어떤 평균으로부터의 편차들의 제곱합

```python
# 세 그룹의 데이터 (임의의 데이터 생성)
group_1 = np.array([23, 25, 27, 22, 20, 30, 28, 26, 24, 29])
group_2 = np.array([31, 33, 35, 29, 27, 40, 36, 34, 32, 38])
group_3 = np.array([19, 21, 17, 23, 18, 20, 22, 19, 21, 24])

# 일원분산분석 (ANOVA) 수행
f_stat, p_value = stats.f_oneway(group_1, group_2, group_3) # F : 42.2481, p-value < alpha
```

# 카이제곱검정

> 카이제곱검정 : 횟수 관련 데이터에 주로 사용되며 예상되는 분포에 얼마나 잘 맞는지를 검정

- 카이제곱통계량 : 기댓값으로부터 어떤 관찰값까지의 거리를 나타내는 측정치
- 기댓값 : 어떤 가정(보통 귀무가설)으로부터 데이터가 발생할 때, 그에 대해 기대하는 정도
- 피어슨 잔차 : $$ R = \frac{관측값 - 기댓값}{\sqrt{기댓값}} $$
- 자유도 : (r-1)(c-1) [ r : 행, c : 열 ]

```python
# 교차표 (contingency table) 데이터 생성
# 예시: 두 범주형 변수의 교차 빈도
#       예를 들어, 그룹 A와 그룹 B에서 특정 결과를 얻은 빈도
observed = np.array([[20, 30],
                     [25, 35]])

# 카이제곱 검정 수행
chi2_stat, p_value, dof, expected = stats.chi2_contingency(observed)

# 결과 출력
print(f"Chi-Square 통계량: {chi2_stat:.4f}") # 카이제곱 통계량 : 1
print(f"P-값: {p_value:.4f}") # 0
print(f"자유도: {dof}") # 1
print("기대빈도:\n", expected)
# [[20.45454545 29.54545455]
# [24.54545455 35.45454545]]
```

# 멀티암드 밴딧 알고리즘

> 멀티암드 밴딧 알고리즘은 실험설계에 대한 전통적인 통계적 접근 방식보다 명시적인 최적화와 좀 더 빠른 의사 결정을 가능하게 하며,  
> 여러 테스트, 특히 웹 테스트를 위해 사용된다.

- 멀티암드 밴딧(MAB) : 고객이 선택할 수 있는 손잡이가 여러 개인 가상의 슬롯머신을 말하며, 각 손잡이는 각기 다른 수익을 가져다준다.
- 손잡이(arm) : 실험에서 어떤 하나의 처리를 말한다.
- 상금(수익) : 슬롯머신으로 딴 상금에 대한 실험적 비유

# 검정력과 표본크기

- 효과크기 : 통계 검정을 통해 판단할 수 있는 효과의 최소 크기
- 검정력 : 주어진 표본크기로 주어진 효과크기를 알아낼 확률
- 유의수준 : 검증 시 사용할 통계 유의수준

---
layout : markdown
title : Network - 04
tags : [Computer_Engineering]
toc : true
---

{% include markdown.html %}

# 전송 계층

- 전송 계층의 역할
1. 응용 계층의 어플리케이션 프로세스 식별
2. 네트워크 계층의 신뢰성/연결성 확립

## 포트

- 포트 번호는 16비트로 표현 가능
- 포트 범위 : 0번부터 65535번까지

- 서버 : 일반적으로 잘 알려진 포트와 등록된 포트로 동작
- 클라이언트 : 일반적으로 동적 포트로 동작

- NAT : 공인 IP주소와 사설 IP 주소 간의 변환 가능
> 하나의 공인 IP 주소를 여러 사설 IP 주소가 공유 가능  
> IP 주소 부족 문제 해결

## TCP와 UDP

- MSS : TCP 세그먼트로 보낼 수 있는 최대 크기

- TCP 세그먼트 구조
1. 출발지 포트
2. 목적지 포트
3. 순서 번호 : 송수신되는 세그먼트 데이터 첫 바이트에 부여되는 번호
4. 확인 응답 번호 : 순서 번호에 대한 응답 (다음으로 수신받길 기대하는 바이트 번호)
5. 제어 비트
> ACK : 세그먼트 승인을 나타내는 비트  
> SYN : 연결 수립을 위한 비트  
> FIN : 연결을 끝내기 위한 비트  
> RST : 연결을 리셋하기 위한 비트
6. 윈도우 : 수신지 윈도우 크기. 한 번에 수신 받고자 하는 양(흐름 제어에서 언급)

- UDP는 IP 패킷을 감싸는 껍데기일 뿐
> 비연결성/비신뢰성 프로토콜  
> TCP의 재전송/흐름 제어/혼잡 제어 등의 기능 없음

## TCP 연결

- TCP는 연결형 프로토콜
1. 연결 설정[ Three-way handshake ]
2. 데이터 송수신
3. 연결 종료

## TCP 상태

- TCP의 연결형 프로토콜
```
> CLOSED : 아무런 연결이 없는 상태
> LISTEN / SYN-SENT / SYN-RECEIVED : 연결 수립 도중 사용되는 상태
> ESTABLISHED : 연결되어 있는 상태  
> FIN-WAIT-1 / FIN-WAIT-2 / CLOSE-WAIT / CLOSING / LAST-ACK / TIME-WAIT : 연결 해제시 사용되는 상태
```

## TCP 재전송 기능

- TCP는 신뢰성 프로토콜

> 무엇인가를 확실히 전송했다는 보장이 있으려면
1. 재전송 기반의 오류 제어 : 잘못 전송된 경우 재전송
2. 흐름 제어 : 받을 수 있을 만큼만 받기
3. 혼잡 제어 : 보낼 수 있는 상황에서만 보내기  

> 언제 잘못 되었음을 인지할까?
1. 중복된 ACK 세그먼트를 수신했을 때
2. 타임아웃이 발생했을 때

- TCP 오류 제어
> TCP는 재전송 기반의 오류 제어를 수행  
> 재전송을 기반으로 잘못된 전송을 바로잡는 것 : ARQ(자동 재전송 요구)

- ARQ
1. Stop-and-Wait ARQ
2. Go-Back-N ARQ
3. Selective Repeat ARQ

## TCP의 혼잡 제어와 흐름제어

- 송신 버퍼 : 어플리케이션 계층에서 전송할 데이터 임시 저장
- 수신 버퍼 : 네트워크 계층에서 수신할 데이터 임시 저장
- 버퍼 오버플로우 : 일부 데이터가 처리되지 않을 수 있음

- 윈도우 : 파이프라이닝 가능한 순서번호 범위
- 윈도우 크기 : 확인 응답 받지 않고도 한번에 보낼 수 있는 최대 양
- RTT(Round Trip Time) : 메세지를 전송한 뒤 그에 대한 답변을 받는 시간

- TCP 혼잡 제어
> 기본 동작 형태 : AIMD(Additive Increase Multicative Decrease)  
> 느린 시작 : 특정 임계치(sshresh)값과 같아지면 혼잡 회피 수행  
> 혼잡 회피 : 세 번의 중복 세그먼트가 발생했을 경우 빠른 회복 수행  
> 빠른 회복 : 세 번의 중복 ACK 세그먼트가 수신되었을 때 느린 시작을 건너뛰고 혼잡 회피를 수행하는 알고리즘
